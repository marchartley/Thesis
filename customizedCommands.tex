\def\zzcommand#1{\let#1\undefined\newcommand#1}

\makeatletter
\LetLtxMacro\OldSection\section
\DeclareRobustCommand{\section}{%
  \@ifstar{\sectionstar}{\sectionnostar}%
}
\zzcommand{\sectionnostar}[1]{%
  \begingroup
  \zzcommand{\inheading}{}%
  \OldSection{#1}
  \endgroup
}
\zzcommand{\sectionstar}[1]{%
    \begingroup
    \zzcommand{\inheading}{}%
    \OldSection*{#1}
    \endgroup
}
\makeatother

\makeatletter
\LetLtxMacro\OldSubsection\subsection
\DeclareRobustCommand{\subsection}{%
  \@ifstar{\Subsectionstar}{\Subsectionnostar}%
}
\zzcommand{\Subsectionnostar}[1]{%
  \begingroup
  \zzcommand{\inheading}{}%
  \OldSubsection{#1}
  \endgroup
}
\zzcommand{\Subsectionstar}[1]{%
    \begingroup
    \zzcommand{\inheading}{}%
    \OldSubsection*{#1}
    \endgroup
}
\makeatother

\makeatletter
\LetLtxMacro\OldSubsubsection\subsubsection
\DeclareRobustCommand{\subsubsection}{%
  \@ifstar{\Subsubsectionstar}{\Subsubsectionnostar}%
}
\zzcommand{\Subsubsectionnostar}[1]{%
  \begingroup
  \zzcommand{\inheading}{}%
  \OldSubsubsection{#1}
  \endgroup
}
\zzcommand{\Subsubsectionstar}[1]{%
    \begingroup
    \zzcommand{\inheading}{}%
    \OldSubsubsection*{#1}
    \endgroup
}
\makeatother

% \let\oldsection\section
% \renewcommand{\section}[1]{%
%   \begingroup
%   \newcommand{\inheadingcontext}{}%
%   \oldsection{TEST2}%
%   \endgroup
% }
% \renewcommand{\section*}[1]{%
%   \begingroup
%   \newcommand{\inheadingcontext}{}%
%   \oldsectionstar{TEST}%
%   \endgroup
% }


\LetLtxMacro{\Oldincludegraphics}{\includegraphics}
\RenewDocumentCommand{\includegraphics}{O{} m}{%
	\begin{adjustbox}{max width=\textwidth, max height=\textheight-5\baselineskip}
	    \Oldincludegraphics[#1]{#2}
	\end{adjustbox}
}
\newcommand{\inset}[3][0.2\linewidth]{
    \noindent\stackinset{r}{0.1cm}{b}{0.1cm}{
        \colorbox{white}{
            \includegraphics[width=#1]{#3}
        }
    }
	{\includegraphics{#2}}
}

\newcommand{\teaser}[1]{
    \begin{figure*}
        #1
    \end{figure*}
}

\def\minitoc{
	\etocsettocstyle{\section*{\contentsname}}{}
	\localtableofcontents
	\noindent\textbf{\hyperlink{tocpage}{Back to summary}}
}
% \makeatletter\@addtoreset{chapter}{part}\makeatother%

\sisetup{product-units=repeat}

\emergencystretch=1em

% \setkeys{Gin}{width=\linewidth}

\renewcommand{\cellalign}{cl}
\newcolumntype{H}{>{\setbox0=\hbox\bgroup}c<{\egroup}@{}}

\DeclareCiteCommand{\cite}[\mkbibparens]
  {\usebibmacro{prenote}\usebibmacro{cite:init}}
  {\usebibmacro{citeindex}
   \printtext[bibhyperref]{\usebibmacro{cite}}}
  {\multicitedelim}
  {\usebibmacro{postnote}}

\newbibmacro*{citefullbody}{
  \printnames{labelname}
  \setunit{\addcomma\space}
  \textit{\printfield[]{title}} % remove quotes
  % \textit{\printfield[citetitle]{title}}
  % \setunit{\nameyeardelim}
  (\printfield{year})
}

\DeclareCiteCommand{\citep}
{\usebibmacro{prenote}\usebibmacro{cite:init}}
{\usebibmacro{citeindex}
 \printtext[bibhyperref]{\usebibmacro{citefullbody}}}
{\multicitedelim}
{\usebibmacro{postnote}}

\AtEveryBibitem{\clearfield{url}}
\AtEveryBibitem{\clearfield{note}} % Notes from Mendeley

\lstset {
    language=C++,
    backgroundcolor=\color{black!5}, % set backgroundcolor
    basicstyle=\footnotesize,% basic font setting
}

\makeglossaries
\DeclareDocumentCommand{\newdualentry}{ O{} O{} m m m m g } {
    \newglossaryentry{gls-#3}{
        name={#5},
        text={#5\if\relax\detokenize{#4}\relax\else\glsadd{#3}\fi},
        plural={\IfValueTF{#7}{#7}{#5s}},
        longplural={\IfValueTF{#7}{#7}{#5s}},
        description={#6},
        #1
    }
    \if\relax\detokenize{#4}\relax
    % nothing
  \else
    \newacronym[longplural={\IfValueTF{#7}{#7}{#5s}}, 
        see={[Glossary:]{gls-#3}},
        #2]{#3}{#4}{#5\glsadd{gls-#3}}
  \fi
    \makeglossaries
}



\zzcommand{\gloss}[1]{\ifglsentryexists{gls-#1}{\glsentryname{gls-#1}\ifcsdef{inheading}{}{{\glsadd{gls-#1}}}}{[XXXX]}}
\zzcommand{\glosses}[1]{\ifglsentryexists{gls-#1}{\glsentrylongpl{gls-#1}\ifcsdef{inheading}{}{{\glsadd{gls-#1}}}}{[XXXX]}}
\zzcommand{\Gloss}[1]{\ifglsentryexists{gls-#1}{\Glsentryname{gls-#1}\ifcsdef{inheading}{}{{\glsadd{gls-#1}}}}{[XXXX]}}
\zzcommand{\Glosses}[1]{\ifglsentryexists{gls-#1}{\Glsentrylongpl{gls-#1}\ifcsdef{inheading}{}{{\glsadd{gls-#1}}}}{[XXXX]}}
\zzcommand{\glsnamefont}[1]{\makefirstuc{#1}}



% \zzcommand{\gloss}[1]{\glsentryname{gls-#1}} % \ifcsdef{inheading}{\glsentryname{gls-#1}}{\ifglsentryexists{#1}{\gls{#1}\glsadd{gls-#1}}{\gls{gls-#1}}}}
% \zzcommand{\glosses}[1]{\glsentrylongpl{gls-#1}} % \ifcsdef{inheading}{\glsentrylongpl{gls-#1}}{\ifglsentryexists{#1}{\glspl{#1}\glsadd{gls-#1}}{\glspl{gls-#1}}}}
% \zzcommand{\Gloss}[1]{\Glsentryname{gls-#1}} % \ifcsdef{inheading}{\Glsentryname{gls-#1}}{\ifglsentryexists{#1}{\Gls{#1}\glsadd{gls-#1}}{\Gls{gls-#1}}}}
% \zzcommand{\Glosses}[1]{\Glsentrylongpl{gls-#1}} % \ifcsdef{inheading}{\Glsentrylongpl{gls-#1}}{\ifglsentryexists{#1}{\Glspl{#1}\glsadd{gls-#1}}{\Glspl{gls-#1}}}}
% \zzcommand{\glsnamefont}[1]{\makefirstuc{#1}}

% \let\oldchapter\chapter
% \renewcommand{\chapter}[1]{
%   \begingroup
%   \newcommand{\inheading}{}
%   \oldchapter{#1}
%   \endgroup
% }

\let\ref=\cref
\let\eqref=\cref

\zzcommand{\to}{\mapsto}